## 概率模型
模型描述世界部分的运行方式
模型总是简化的，可能无法考虑所有变量，无法解释变量之间的所有相互作用

使用完全联合分布表作为我们的概率模型有两个问题
除非只有几个变量，否则联合分布太大而无法显式表示
很难同时对几个以上的变量进行经验学习（估计）

贝叶斯网络：用简单的局部分布（条件概率）描 述复杂的联合分布（模型）的技术更恰当的叫法是图模型
我们描述了变量如何在局部相互作用
局部交互链接在一起，形成全局的间接交互

## Representation 表示
### 定义
- node 节点
	- 表示变量带有定义域
	- 可指定（观察到的）或未指定（观察不到的）
- edge 边
	- 相互作用表示变量之间的直接影响
	- 形式上：编码条件独立性
- 有向无环图，每个随机变量一个节点
- 现在：想象箭头意味着因果关系
下雨导致交通堵塞，这两个节点之间就有了一条边，表示可能的因果关系

### Bayes Net Semantics
- 贝叶斯网络由一组变量及其条件依赖性构成
- 每个节点代表一个随机变量X
- 节点间的箭头代表变量之间的条件依赖
- 节点的条件概率是由CPT *conditional probability table*（条件概率表）给出
- CPT为每个变量定义了在其父变量特定值下的概率
- 计算联合概率时可以使用条件概率来简化计算
- 贝叶斯网络中的计算，如$P(X|A_1...A_n)$，考虑了给定父变量$A_1$至$A_n$时，变量$X$的概率

### 因果关系
贝叶斯网络是一种对域的概率模型进行有效编码的方法

- 贝叶斯网络(BNs)不一定是真正的因果关系：
- 方向性箭头不代表因果关系（尽管在某些情况下可能会有这样的解释） 
- 例如，箭头表示“父辈变量”和“子变量”。
- 父辈和子变量之间的关系是概率性的，而不是因果关系

拓扑真正编码的是条件独立性
$P(x_i | x_1, ..., x_{i-1}) = P(x_i | parents(X_i))$

### 规模
复杂度计算：
- N个布尔变量的联合概率分布有$2^N$个可能的状态。
- 如果要为每个状态计算概率，时间复杂度是$O(N * 2^k+1)$，其中k是变量的数量。
- 两者都要计算$P(x1,x2...xn)$ BNs:节省大量空间

## 条件独立性
Conditional Independence
概率独立性：
- 如果两个事件X和Y是独立的，那么$P(X,Y) = P(X)P(Y)$，记作$X⊥Y$。（应该有两个竖线 $\Prep$ )
- 如果X和Y给定Z时是条件独立的，那么$P(X,Y|Z) = P(X|Z)P(Y|Z)$，记作$X⊥Y|Z$。

链式法则与条件独立性的应用：
- 贝叶斯网络中的链式法则可以用来分解联合概率分布。
- 链式法则的形式是$P(X1,...,Xn)=$Π$P(Xi|parents(Xi))$，即每个变量的概率乘以它在给定其父变量的条件下的概率。

贝叶斯网络的条件独立性假设：
- 贝叶斯网络的一个关键假设是网络中的变量在给定其父变量的情况下相互独立。
- 这个假设允许我们通过更少的参数来表示整个网络的联合概率分布。

### D-Separation
研究三元组的独立性属性
根据成员三元组分析复杂情况
D-separation：回答此类查询的条件/算法

- 因果链
	- ![[Screenshot 2023-12-17 at 20.12.28.png]]
	- 保证X与Z相互独立？no
	- 给定y的情况下**能**保证X独立于Z
- 共同原因
	- ![[Screenshot 2023-12-17 at 20.12.46.png]]
- 共同影响
	- ![[Screenshot 2023-12-17 at 20.12.58.png]]

一般情况：在给定的Bayes Net图中，两个变量是独立的吗？
**分析图**，任何复杂的例子都能分解为三种典型情况的重复。

#### 可达性
- 遮蔽证据节点，在结果图中寻找路径
- 如果两个节点之间所有无向路径都被证据节点阻断，则这两个节点在给定证据的条件下是条件独立的
- 如果至少一条路径未被证据节点阻断，则这两个节点是条件相关的
	- 以上几乎都成立
		- 除了
		- ![[Screenshot 2023-12-17 at 20.10.34.png]]
		- T处的V结构，不算做路径中的链接，除非处于**激活**状态

#### 激活/非激活路径
问题：给定证据变量Z后，X和Y是否条件独立
灰色：given

![[Screenshot 2023-12-17 at 20.13.42.png]]
#### D-Separation

![[Screenshot 2023-12-17 at 20.15.08.png]]
### 拓扑限制分布
![[Screenshot 2023-12-17 at 20.27.16.png]]

### 总结
贝叶斯网络对联合分布进行紧凑编码
可以从BN图中推导出保证的分布独立性
D-Separation提供精确的条件独立性保证
贝叶斯网络的联合分布可能具有进一步的（有条件的）独立性，直到您检查其特定分布时才会发现

## Probabilistic Inference
概率推理 一种基于贝叶斯网络的精确推理的方法
通过枚举进行推理![[Screenshot 2023-12-17 at 21.59.02.png]]


### 操作
#### 连接因子
第一项基本操作。
组合因子：就像数据库链接一样，获取连接变量上的所有因子，在相关变量的并集上建立一个新因子。每个条目的计算方法：点积。![[Screenshot 2023-12-17 at 22.00.59.png]]
从二重连接扩展到多重连接。

#### 消除
- 边缘化
- 取一个因子，求一个变量的和
	- 将因子缩小到更小的因子
	- 投影操作
多重消除![[Screenshot 2023-12-17 at 22.03.20.png]]

**多重连接、多重消除 --> 枚举推理**

### 证据


### 时间和空间复杂性
变量消除的计算和空间复杂度取决于最大因子

## Sampling 采样
一种基于贝叶斯网络的近似推理的方法，基于采样而不是概率计算
### 概念
- 基本思想
	- 从抽样分布S中抽取N个样本
	- 计算近似后验概率
	- 证明它收敛于真实概率P
- 为什么要采样
	- 学习：从位置分布中获取样本
	- 推理：获取样本比计算正确答案更快
### Prior Sampling 事先采样
$P(Q)$
对i=1,2,...n按照拓扑顺序排列，返回$(x_1,x_2,...x_n)$
这个过程会产生概率样本:
$$
S_{P S}\left(x_1 \ldots x_n\right)=\prod_{i=1}^n P\left(x_i \mid \operatorname{Parents}\left(X_i\right)\right)=P\left(x_1 \ldots x_n\right)
$$
即 BN 的联合概率
设一个事件的样本数为
$$
N_{P S}\left(x_1 \ldots x_n\right)
$$

然后
$$
\begin{aligned}
\lim _{N \rightarrow \infty} \hat{P}\left(x_1, \ldots, x_n\right) & =\lim _{N \rightarrow \infty} N_{P S}\left(x_1, \ldots, x_n\right) / N \\
& =S_{P S}\left(x_1, \ldots, x_n\right) \\
& =P\left(x_1 \ldots x_n\right)
\end{aligned}
$$

也就是说，抽样过程是一致的

示例 
![[Screenshot 2023-12-17 at 22.07.32.png]]
### Rejection Sampling 拒绝采样
$P(Q|e)$
![[Screenshot 2023-12-17 at 22.07.07.png]]
- 过程
	- 输入：证据实例化
	- 从i=1,2,...n 按拓扑顺序排列
		- 从$P(X_i|Parents(X_i))$中采样$x_i$
		- 如果$x_i$与证据不一致
			- 拒绝：返回 - 在此循环中不生成样本
	- 返回$(x_1,x_2,...,x_n)$

### Likelihood Weighting 可能性加权
$P(Q|e)$
拒绝采样的问题：如果证据不可能存在，就会剔除大量样本
想法：固定证据变量，对其余变量进行抽样

- 过程
	- 输入：证据实例化
	- w = 1.0
	- 对于i=1,2,...n按拓扑顺序排列
		- 如$X_i$ 是一个证据变量
			- $X_i=X_i$观测值$x_i$
			- 设$w=w*P(x_i|Parents(X_i))$
		- 否则
			- 从$P(x_i|Parents(X_i))$中采样$x_i$
	- 返回$(x_1,x_2,...,x_n), w$

![[Screenshot 2023-12-17 at 22.06.54.png]]
此方法的好处：生成样本时已经将证据考虑在内
问题：证据会影响下游但不会影响上游
解决：对每个变量采样时都考虑证据 -> 吉布斯采样

### Gibbs Sampling 吉布斯采样
$P(Q|e)$

![[Screenshot 2023-12-17 at 22.06.25.png]]

![[Screenshot 2023-12-17 at 22.06.36.png]]


> 吉布斯抽样属于被称为马尔科夫链蒙特卡罗（MCMC）的抽样方法系列。具体来说，它是 MCMC 方法子集 Metropolis-Hastings 的一个特例。